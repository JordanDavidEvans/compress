# compress

A static WebP compression site designed for Cloudflare Pages. Drop or select multiple images and the browser converts them to WebP at 97% quality, scaling resolution in steps until they land under your target size (500KB by default).

## Usage
1. Open `src/index.html` locally or deploy the repo to Cloudflare Pages.
2. Adjust the target size slider if you need something other than 500KB.
3. Drag and drop or click to select multiple images—the compression starts instantly.
4. Download the resulting WebP files once the progress cards show "Compression ready."

All processing happens in your browser; no images are uploaded to any server.

## Repository layout
- `src/index.html` – main static experience.
- `dist/` – build output generated by `npm run build` (not committed).
- `wrangler.toml` – Cloudflare Pages configuration with `pages_build_output_dir` set to `dist`.
- `package.json` – build, preview, deploy, and version scripts wired for Wrangler.

## Local development
1. Install dependencies: `npm install`.
2. Build the static assets: `npm run build` (copies `src` to `dist`).
3. Preview locally with the Pages dev server: `npm run dev`.

## Deployment (Cloudflare Pages)
- **Build command:** `npm run build`
- **Deploy command:** `npm run deploy` (runs `npm run build` then `wrangler pages deploy dist`).
- **Version command:** `npm run versions:upload`.
- **Root directory:** `/` (build output at `dist`).
- **Production branch:** `main` (non-production branches supported by Wrangler Pages).
- **Non-production branch builds:** Enabled (default Pages behavior).
- **Build cache:** Disabled (safe for static assets; optional to enable later).
- **Build watch paths:** Include `*` so all paths trigger builds.
- **API token:** Use the provided `lsqa build token` with permissions for Pages deploys and Workers versions uploads.

> **Heads up:** `wrangler deploy` is a Workers-only command and will fail for this Pages project (see the error in the deploy logs). Always use `wrangler pages deploy`—the `npm run deploy` script already wraps the correct command for you.

### Fixing "Workers-specific command" errors in CI
If your CI/CD system is still calling `npx wrangler deploy`, switch it to `npm run deploy` so the Pages-specific command runs instead. On Cloudflare Pages, set the **Deploy command** to `npm run deploy`; on other platforms, update the workflow or build step to run the same script after `npm run build` finishes.
